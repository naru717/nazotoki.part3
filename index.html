<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>謎解きアプリ第３弾：急変対応のなぞ（TMC）</title>
<style>
  :root{
    --bg:#fff7fb; --card:#ffffff; --text:#1f2937; --muted:#6b7280;
    --accent:#ff7ac6; --ok:#16a34a; --ng:#ef4444; --ring:#ffd5ec;
    --gold:#ffcc66; --spark:#fff2a8;
  }
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#fff7fb 0%, #f5fbff 100%);
    color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,Arial,sans-serif;
    -webkit-tap-highlight-color:transparent;
  }
  .wrap{max-width:900px; margin:0 auto; padding:20px 16px 64px;}
  header{display:flex; align-items:center; gap:12px; margin:6px 0 10px;}
  header h1{font-size:26px; margin:0;}
  .mascot{width:40px; height:40px; border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,.08);}
  .card{background:var(--card); border-radius:20px; box-shadow:0 10px 24px rgba(255,122,198,.15);
        padding:18px; margin:14px 0; border:2px solid var(--ring);}
  .question{font-size:20px; font-weight:800; margin:8px 0 4px;}
  .lead{color:var(--muted); margin-top:2px;}
  .choices{display:grid; gap:10px; margin-top:12px;}
  .choice-btn{width:100%; text-align:left; padding:14px 16px; border-radius:16px; border:2px solid #e7f2ff; background:#fff; cursor:pointer; font-size:16px;}
  .choice-btn:hover{border-color:#cfe7ff; background:#f7fbff;}
  .result{margin-top:10px; font-weight:900; font-size:18px;}
  .ok{color:var(--ok);} .ng{color:var(--ng);}
  .subtitle{font-weight:900; color:#1f2937; margin:6px 0 10px; font-size:18px;}
  .muted-box{background:#fff5fa; border:2px dashed #ffd2ea; padding:10px 12px; border-radius:14px; color:#374151;}
  .explain{margin-top:12px; text-align:left; background:#f7fbff; border:2px solid #dbeafe; border-radius:14px; padding:12px;}
  .fade{animation:fade .25s ease;}
  @keyframes fade{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
  @media (max-width:560px){
    header h1{font-size:22px}
    .question{font-size:18px}
    .choice-btn{font-size:15px; padding:14px}
    .btn{width:100%}
  }

  /* ボタン */
  .btn{
    display:inline-block; padding:14px 18px; border-radius:16px; border:none; cursor:pointer; font-size:16px;
    background:linear-gradient(90deg,var(--accent),#ffa7d8); color:#fff; box-shadow:0 8px 18px rgba(255,122,198,.35);
  }
  .btn:disabled{opacity:.6; cursor:not-allowed;}
  .btn.alt{background:linear-gradient(90deg,#8ec5ff,#b5e1ff);}
  .btn.ghost{ background:#fff; color:#ff4fae; border:2px solid #ffb4df; box-shadow:none; }

  /* 入力フォーム（縦並び） */
  .form-vertical{display:flex; flex-direction:column; gap:12px;}
  label{font-size:14px; color:#6b7280; margin-bottom:6px;}
  input{
    width:100%; padding:14px 14px; font-size:16px; border-radius:14px; border:2px solid #ffdff0; background:#fff; outline:none;
  }
  input:focus{border-color:#ffb3dc; box-shadow:0 0 0 4px #ffe6f4;}

  /* ヒーロー（紹介） */
  .hero{
    display:flex; flex-direction:column; align-items:center; text-align:center; gap:10px;
  }
  .hero img{ width:min(68vw, 300px); height:auto; border-radius:24px; box-shadow:0 10px 26px rgba(0,0,0,.12); }
  .speech{
    background:#ffffff; border:2px solid #ffd5ec; border-radius:18px; padding:12px 14px; line-height:1.7;
    position:relative; max-width:680px;
  }
  .speech:after{
    content:""; position:absolute; top:100%; left:50%; transform:translateX(-50%);
    border:10px solid transparent; border-top-color:#ffd5ec;
  }
  .speech:before{
    content:""; position:absolute; top:calc(100% + 2px); left:50%; transform:translateX(-50%);
    border:10px solid transparent; border-top-color:#ffffff;
  }

  /* 正解スタンプ */
  .stamp{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(255,255,255,.75); z-index:50;}
  .stamp img{width:min(70vw,380px); height:auto; filter:drop-shadow(0 10px 24px rgba(0,0,0,.2)); animation:pop .5s ease;}
  @keyframes pop{0%{transform:scale(.6) rotate(-6deg); opacity:0}60%{transform:scale(1.05) rotate(2deg); opacity:1}100%{transform:scale(1) rotate(0)}}

  /* ===== エンディング豪華版 ===== */
  #screen-ending{ position:relative; overflow:hidden; }
  .ending-wrap{ display:flex; flex-direction:column; align-items:center; gap:12px; text-align:center; }
  .ending-hero{
    width:min(80vw, 420px); height:auto;
    border-radius:28px; box-shadow:0 18px 40px rgba(255,122,198,.35);
    outline:6px solid rgba(255, 213, 236, .6);
  }
  .ending-title{
    font-size:24px; font-weight:900; letter-spacing:.02em;
    background:linear-gradient(90deg,#ff7ac6,#ffcc66); -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .ending-lines{
    line-height:1.9; font-size:16px; color:#374151;
    background:#fffef3; border:2px solid #ffefb6; border-radius:16px; padding:10px 14px;
  }
  .ending-badge{
    display:inline-block; padding:8px 12px; border-radius:999px;
    background:linear-gradient(90deg,#ffd591,#ffe9b6); color:#6b4000; font-weight:800; font-size:13px;
    border:1px solid #f6c66f; box-shadow:0 6px 16px rgba(255,204,102,.35);
  }
  .ending-actions{ display:flex; gap:10px; margin-top:6px; flex-wrap:wrap; justify-content:center; }

  /* 紙吹雪 */
  .confetti{ pointer-events:none; position:absolute; inset:0; overflow:hidden; }
  .confetti span{
    position:absolute; top:-10px; width:10px; height:16px; opacity:.9;
    animation:fall 2.8s linear forwards; transform:rotate(0deg);
  }
  @keyframes fall{
    0%{ transform:translateY(-10px) rotate(0deg); }
    100%{ transform:translateY(120vh) rotate(540deg); }
  }
  /* キラキラ */
  .sparkles{ pointer-events:none; position:absolute; inset:0; }
  .spark{
    position:absolute; width:10px; height:10px; background:radial-gradient(circle, var(--spark) 0%, rgba(255,255,255,0) 70%);
    animation:blink 1.6s ease-in-out infinite;
  }
  @keyframes blink{ 0%,100%{opacity:0.2} 50%{opacity:1} }

  /* ===== タロット演出 ===== */
  .fortune-wrap{
    display:flex; flex-direction:column; align-items:center; gap:10px; margin-top:10px;
  }
  .tarot-hero{
    width:min(62vw, 260px); height:auto; border-radius:22px;
    box-shadow:0 12px 24px rgba(0,0,0,.12);
    outline:4px solid rgba(255,213,236,.6);
  }
  .fortune-lines{
    background:#ffffff; border:2px solid #ffd5ec; border-radius:16px; padding:10px 12px; line-height:1.9;
    min-height:72px; max-width:680px; text-align:left;
  }
  .fortune-line{ opacity:0; transform:translateY(4px); animation:fade .3s ease forwards; }

  .tarot-table{display:flex; gap:10px; justify-content:center; margin-top:12px; flex-wrap:wrap;}
  .tarot-card{
    width:96px; height:140px; border-radius:12px;
    background:linear-gradient(180deg,#fff8fb,#ffe6f4);
    border:2px solid #ffc9e8; box-shadow:0 6px 16px rgba(255,122,198,.25);
    display:flex; align-items:center; justify-content:center; font-weight:800; color:#7a2856; position:relative;
  }
  .tarot-card .cap{
    position:absolute; bottom:6px; left:0; right:0; text-align:center; font-size:12px; color:#92415f;
  }
  .tarot-card.reversed{ transform:rotate(180deg); }

  /* 🆕 タロットアドバイス見出し（追加） */
  .advice-title{
    font-weight:800; color:#7a2856; margin-top:14px; font-size:17px; text-align:left;
    background:#fff5fa; border-left:5px solid #ffb8e0; padding:8px 10px; border-radius:10px;
    animation:fade .6s ease;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="mame2.png" alt="とせいくん（第3弾）" class="mascot" />
      <h1>第３弾：急変対応のなぞ（TMC）</h1>
    </header>

    <!-- 入力画面 -->
    <section id="screen-intro" class="card fade">
      <div class="hero">
        <img src="mame2.png" alt="とせいくん（第3弾）" />
        <div class="speech">
          <strong>ぼくは とせいくん。</strong><br>
          <strong>TMC(とうせいメディカルカップ）のマスコットキャラだよ。</strong><br>
          まずはあなたのこと<strong>教えて！</strong>
        </div>
      </div>
      <div style="height:8px;"></div>
      <div class="form-vertical">
        <div><label for="name">名前</label><input id="name" type="text" placeholder="例）フルネーム" /></div>
        <div><label for="group">所属</label><input id="group" type="text" placeholder="例）外来／〇〇病棟／リハ など" /></div>
        <div><label for="job">職種</label><input id="job" type="text" placeholder="例）看護師／医師／薬剤師 など" /></div>
      </div>
      <div style="margin-top:16px;">
        <button class="btn" id="go-pre" onclick="goPre()">次へ</button>
      </div>
    </section>

    <!-- タロット占いスタート -->
    <section id="screen-pre" class="card fade" style="display:none;">
      <div id="pre-title" class="subtitle"></div>
      <div class="muted-box" style="margin:10px 0 14px;">
        🔮 <strong>とせいくんのタロット占い</strong><br/>
        1枚引いて、今日の「あなたの運勢」を受け取ろう。<br/>
        準備はいい？ では占いスタート！
      </div>
      <button class="btn alt" id="begin-diag" onclick="beginFortune()">カードを１枚引く</button>
    </section>

    <!-- 占い結果 -->
    <section id="screen-diag-result" class="card fade" style="display:none;">
      <div id="type-title" class="question">とせいくんのタロット占い</div>
      <div id="type-copy" class="lead"></div>
      <div class="fortune-wrap">
        <img src="mame2.png" alt="タロットを持つとせいくん" class="tarot-hero" />
        <div class="tarot-table" id="tarot-table"></div>
        <div id="fortune-lines" class="fortune-lines"></div>
      </div>

      <div id="advice-title" class="advice-title" style="display:none;">🔮 タロット占いから出たアドバイス</div>
      <ul id="type-desc" style="text-align:left; line-height:1.8; margin-top:8px;"></ul>

      <div class="muted-box" style="margin-top:12px;">
        さあ、<strong>第３弾：急変対応のなぞ</strong>へ！<br/>
        あなたの力なら解けるはず！！クイズに挑もう。
      </div>
      <button class="btn" id="to-quiz" onclick="toQuiz()" style="margin-top:14px;">第1問へ進む</button>
    </section>

    <!-- クイズ -->
    <section id="screen-quiz" class="card fade" style="display:none;">
      <div id="story" class="lead" style="margin-bottom:8px;"></div>
      <div style="text-align:center; margin:10px 0;">
        <img id="quiz-img" src="" alt="謎の画像" style="max-width:100%; border-radius:14px; box-shadow:0 4px 12px rgba(0,0,0,0.1);" />
      </div>
      <div id="q-title" class="question"></div>
      <div id="choices" class="choices"></div>
      <div id="judge" class="result"></div>
      <div id="explain" class="explain" style="display:none;"></div>
      <div id="next-area" style="display:none; margin-top:12px;">
        <button id="next-btn" class="btn" onclick="goNext()">次へ</button>
      </div>
    </section>

    <!-- エンディング -->
    <section id="screen-ending" class="card fade" style="display:none;">
      <div class="ending-wrap">
        <div class="ending-title">🎉 クリアおめでとう！（第３弾）</div>
        <img src="mame2.png" alt="とせいくん" class="ending-hero" />
        <div class="ending-lines">
          <div class="ending-badge">とうせいの謎・名探偵認定</div>
          <div id="ending-text" style="margin-top:6px;"></div>
          <div style="margin-top:6px;">
            TMCのことで聞きたいことがあれば、いつでもPHS6693に連絡してね。
          </div>
        </div>
        <div class="ending-actions">
          <button class="btn ghost" id="finish-btn">今回の調査を終了する</button>
        </div>
        <div id="finish-message" style="display:none; margin-top:10px; font-weight:800; color:#374151;">
          お疲れ様でした。ありがとうございました。
        </div>
      </div>
      <div class="confetti" id="confetti"></div>
      <div class="sparkles" id="sparkles"></div>
    </section>
  </div>

  <div id="stamp" class="stamp" aria-hidden="true">
    <img src="nazotoki2.png" alt="正解スタンプ" />
  </div>

  <audio id="bgm" src="nazotoki2.mp3" preload="none" loop></audio>
  <audio id="seClick" src="pochi.mp3" preload="auto"></audio>
  <audio id="seCorrect" src="pinpon.mp3" preload="auto"></audio>
  <audio id="seClear" src="seikou.mp3" preload="auto"></audio>

<script>
/* ===== タロット占い（楽しいアドバイス版） ===== */
const tarotDeck = [
  { key:"THE_SUN", title:"太陽",
    upright:["元気いっぱいで何でもうまくいく予感☀️","笑顔が幸運を引き寄せるよ！"],
    reversed:["ちょっとお疲れ気味☁️","無理せずのんびり過ごしてね"],
    tips:["ポジティブな言葉を口にしよう✨","おやつタイムでリフレッシュ🍪"] },
  { key:"THE_STAR", title:"星",
    upright:["夢がキラキラ輝く日🌟","理想を言葉にすると現実が動くかも！"],
    reversed:["現実とのギャップにモヤモヤ？","焦らず今日できることを1つずつ✨"],
    tips:["願いごとをメモに書いてみよう📝","夜空を見上げてリラックス🌙"] },
  { key:"THE_HERMIT", title:"隠者",
    upright:["落ち着いて考えるほど運が味方に✨","静かな時間にひらめきが生まれそう"],
    reversed:["ひとりで抱え込みすぎ注意⚡","誰かに話すとスッキリするよ！"],
    tips:["夜に好きな飲み物で一息☕","マイペースでOK、焦らなくて大丈夫😊"] },
  { key:"JUSTICE", title:"正義",
    upright:["判断力が冴える日⚖️","迷ったら“どっちが笑顔になるか”で決めよう！"],
    reversed:["少し頑固になってるかも？","相手の意見を聞くと流れが変わるよ💡"],
    tips:["感謝の言葉がラッキーを呼ぶ✨","正直な気持ちを大切に💗"] },
  { key:"THE_MAGICIAN", title:"魔術師",
    upright:["新しいことを始めるのにぴったりな日🎩","アイデアがどんどん浮かびそう！"],
    reversed:["準備不足で焦らないように💦","誰かに相談すると道が開けるかも！"],
    tips:["“やってみよう！”が幸運の鍵🔑","ひらめきはスマホにメモしてね✨"] },
  { key:"STRENGTH", title:"力",
    upright:["やさしい気持ちがみんなを救う日💪","深呼吸すればどんなことも大丈夫！"],
    reversed:["イライラ注意⚡","笑顔で受け流すと運気UP⤴️"],
    tips:["ほめ言葉を積極的に伝えてみよう😊","自分も“よく頑張ってるね”って言ってあげて💐"] },
  { key:"TEMPERANCE", title:"節制",
    upright:["バランス感覚が光る日🌈","仕事も休憩もいい感じのリズム✨"],
    reversed:["少し頑張りすぎかも💦","お菓子とコーヒーでリフレッシュ🍫"],
    tips:["“まあいっか”が幸運を呼ぶ🌷","焦らずマイペースが吉！"] },
  { key:"THE_WORLD", title:"世界",
    upright:["やりきる達成感が味わえる日🌍","みんなと喜びを分かち合おう！"],
    reversed:["あと少しで完成✨","焦らず丁寧に進めてOK👌"],
    tips:["終わったらごほうびスイーツを🍰","思い出の写真を撮って残そう📸"] }
];

/* ===== タロット処理 ===== */
function drawTarot(){
  const idx=Math.floor(Math.random()*tarotDeck.length);
  const up=Math.random()<0.7;
  const card=tarotDeck[idx];
  return {card,upright:up};
}
function renderFortune(lines){
  const fortuneLinesEl=document.getElementById('fortune-lines');
  fortuneLinesEl.innerHTML="";
  let i=0;
  (function next(){
    if(i>=lines.length)return;
    const div=document.createElement('div');
    div.className='fortune-line';
    div.textContent=lines[i++];
    fortuneLinesEl.appendChild(div);
    setTimeout(next,900);
  })();
}
function showAdviceTitle(){
  const at=document.getElementById('advice-title');
  if(at) at.style.display="block";
}
function beginFortune(){
  const result=drawTarot();
  const tarotTable=document.getElementById('tarot-table');
  tarotTable.innerHTML="";
  const cardEl=document.createElement('div');
  cardEl.className='tarot-card'+(result.upright?'':' reversed');
  cardEl.innerHTML='<div style="font-size:32px;">🔮</div><div class="cap">'+result.card.title+(result.upright?'（正位置）':'（逆位置）')+'</div>';
  tarotTable.appendChild(cardEl);
  const lines=[
    "とせいくんがカードをシャッフル中……",
    "出たのは「"+result.card.title+"」！",
    result.upright?"今日は正位置。ツイてる日みたい✨":"今日は逆位置。でも落ち着けばうまくいくよ🌸",
    ...(result.upright?result.card.upright:result.card.reversed)
  ];
  document.getElementById('type-copy').textContent="今日のキーワード："+(result.upright?"前向きな流れ":"ひと休みも大事");
  const ul=document.getElementById('type-desc');
  ul.innerHTML="";
  result.card.tips.forEach(t=>{
    const li=document.createElement('li');
    li.textContent="🔸 "+t;
    ul.appendChild(li);
  });
  showAdviceTitle();
  renderFortune(lines);
  document.getElementById('screen-diag-result').style.display='block';
}
</script>
</body>
</html>

