<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>è¬è§£ãã‚¢ãƒ—ãƒªç¬¬ï¼“å¼¾ï¼šæ€¥å¤‰å¯¾å¿œã®ãªãï¼ˆTMCï¼‰</title>
<style>
  :root{
    --bg:#fff7fb; --card:#ffffff; --text:#1f2937; --muted:#6b7280;
    --accent:#ff7ac6; --ok:#16a34a; --ng:#ef4444; --ring:#ffd5ec;
    --gold:#ffcc66; --spark:#fff2a8;
  }
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#fff7fb 0%, #f5fbff 100%);
    color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,Arial,sans-serif;
    -webkit-tap-highlight-color:transparent;
  }
  .wrap{max-width:900px; margin:0 auto; padding:20px 16px 64px;}
  header{display:flex; align-items:center; gap:12px; margin:6px 0 10px;}
  header h1{font-size:26px; margin:0;}
  .mascot{width:40px; height:40px; border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,.08);}
  .card{background:var(--card); border-radius:20px; box-shadow:0 10px 24px rgba(255,122,198,.15);
        padding:18px; margin:14px 0; border:2px solid var(--ring);}
  .question{font-size:20px; font-weight:800; margin:8px 0 4px;}
  .lead{color:var(--muted); margin-top:2px;}
  .choices{display:grid; gap:10px; margin-top:12px;}
  .choice-btn{width:100%; text-align:left; padding:14px 16px; border-radius:16px; border:2px solid #e7f2ff; background:#fff; cursor:pointer; font-size:16px;}
  .choice-btn:hover{border-color:#cfe7ff; background:#f7fbff;}
  .result{margin-top:10px; font-weight:900; font-size:18px;}
  .ok{color:var(--ok);} .ng{color:var(--ng);}
  .subtitle{font-weight:900; color:#1f2937; margin:6px 0 10px; font-size:18px;}
  .muted-box{background:#fff5fa; border:2px dashed #ffd2ea; padding:10px 12px; border-radius:14px; color:#374151;}
  .explain{margin-top:12px; text-align:left; background:#f7fbff; border:2px solid #dbeafe; border-radius:14px; padding:12px;}
  .fade{animation:fade .25s ease;}
  @keyframes fade{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
  @media (max-width:560px){
    header h1{font-size:22px}
    .question{font-size:18px}
    .choice-btn{font-size:15px; padding:14px}
    .btn{width:100%}
  }

  /* ãƒœã‚¿ãƒ³ */
  .btn{
    display:inline-block; padding:14px 18px; border-radius:16px; border:none; cursor:pointer; font-size:16px;
    background:linear-gradient(90deg,var(--accent),#ffa7d8); color:#fff; box-shadow:0 8px 18px rgba(255,122,198,.35);
  }
  .btn:disabled{opacity:.6; cursor:not-allowed;}
  .btn.alt{background:linear-gradient(90deg,#8ec5ff,#b5e1ff);}
  .btn.ghost{ background:#fff; color:#ff4fae; border:2px solid #ffb4df; box-shadow:none; }

  /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼šå…ƒã®ã¾ã¾ */
  .form-vertical{display:flex; flex-direction:column; gap:12px;}
  label{font-size:14px; color:#6b7280; margin-bottom:6px;}
  input{
    width:100%; padding:14px 14px; font-size:16px; border-radius:14px; border:2px solid #ffdff0; background:#fff; outline:none;
  }
  input:focus{border-color:#ffb3dc; box-shadow:0 0 0 4px #ffe6f4;}

  /* ãƒ’ãƒ¼ãƒ­ãƒ¼ */
  .hero{
    display:flex; flex-direction:column; align-items:center; text-align:center; gap:10px;
  }
  .hero img{ width:min(68vw, 300px); height:auto; border-radius:24px; box-shadow:0 10px 26px rgba(0,0,0,.12); }
  .speech{
    background:#ffffff; border:2px solid #ffd5ec; border-radius:18px; padding:12px 14px; line-height:1.7;
    position:relative; max-width:680px;
  }
  .speech:after{
    content:""; position:absolute; top:100%; left:50%; transform:translateX(-50%);
    border:10px solid transparent; border-top-color:#ffd5ec;
  }
  .speech:before{
    content:""; position:absolute; top:calc(100% + 2px); left:50%; transform:translateX(-50%);
    border:10px solid transparent; border-top-color:#ffffff;
  }

  /* æ­£è§£ã‚¹ã‚¿ãƒ³ãƒ— */
  .stamp{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(255,255,255,.75); z-index:50;}
  .stamp img{width:min(70vw,380px); height:auto; filter:drop-shadow(0 10px 24px rgba(0,0,0,.2)); animation:pop .5s ease;}
  @keyframes pop{0%{transform:scale(.6) rotate(-6deg); opacity:0}60%{transform:scale(1.05) rotate(2deg); opacity:1}100%{transform:scale(1) rotate(0)}}

  /* ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼šç”»åƒã‚µã‚¤ã‚ºã‚’ mascot ã«æˆ»ã™ */
  #screen-ending{ position:relative; overflow:hidden; }
  .ending-wrap{ display:flex; flex-direction:column; align-items:center; gap:12px; text-align:center; }
  .ending-title{
    font-size:24px; font-weight:900; letter-spacing:.02em;
    background:linear-gradient(90deg,#ff7ac6,#ffcc66); -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .ending-lines{
    line-height:1.9; font-size:16px; color:#374151;
    background:#fffef3; border:2px solid #ffefb6; border-radius:16px; padding:10px 14px;
  }
  .ending-badge{
    display:inline-block; padding:8px 12px; border-radius:999px;
    background:linear-gradient(90deg,#ffd591,#ffe9b6); color:#6b4000; font-weight:800; font-size:13px;
    border:1px solid #f6c66f; box-shadow:0 6px 16px rgba(255,204,102,.35);
  }
  .ending-actions{ display:flex; gap:10px; margin-top:6px; flex-wrap:wrap; justify-content:center; }

  /* ç´™å¹é›ª */
  .confetti{ pointer-events:none; position:absolute; inset:0; overflow:hidden; }
  .confetti span{
    position:absolute; top:-10px; width:10px; height:16px; opacity:.9;
    animation:fall 2.8s linear forwards; transform:rotate(0deg);
  }
  @keyframes fall{
    0%{ transform:translateY(-10px) rotate(0deg); }
    100%{ transform:translateY(120vh) rotate(540deg); }
  }
  .sparkles{ pointer-events:none; position:absolute; inset:0; }
  .spark{
    position:absolute; width:10px; height:10px; background:radial-gradient(circle, var(--spark) 0%, rgba(255,255,255,0) 70%);
    animation:blink 1.6s ease-in-out infinite;
  }
  @keyframes blink{ 0%,100%{opacity:0.2} 50%{opacity:1} }

  /* ã‚¿ãƒ­ãƒƒãƒˆ */
  .fortune-wrap{ display:flex; flex-direction:column; align-items:center; gap:10px; margin-top:10px; }
  .tarot-hero{
    width:min(62vw, 260px); height:auto; border-radius:22px;
    box-shadow:0 12px 24px rgba(0,0,0,.12);
    outline:4px solid rgba(255,213,236,.6);
  }
  .fortune-lines{
    background:#ffffff; border:2px solid #ffd5ec; border-radius:16px; padding:10px 12px; line-height:1.9;
    min-height:72px; max-width:680px; text-align:left;
  }
  .fortune-line{ opacity:0; transform:translateY(4px); animation:fade .3s ease forwards; }

  .tarot-table{display:flex; gap:10px; justify-content:center; margin-top:12px; flex-wrap:wrap;}
  .tarot-card{
    width:96px; height:140px; border-radius:12px;
    background:linear-gradient(180deg,#fff8fb,#ffe6f4);
    border:2px solid #ffc9e8; box-shadow:0 6px 16px rgba(255,122,198,.25);
    display:flex; align-items:center; justify-content:center; font-weight:800; color:#7a2856; position:relative;
  }
  .tarot-card .cap{
    position:absolute; bottom:6px; left:0; right:0; text-align:center; font-size:12px; color:#92415f;
  }
  .tarot-card.reversed{ transform:rotate(180deg); }

  .advice-title{
    font-weight:800; color:#7a2856; margin-top:14px; font-size:17px; text-align:left;
    background:#fff5fa; border-left:5px solid #ffb8e0; padding:8px 10px; border-radius:10px;
    animation:fade .6s ease;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="mame2.png" alt="ã¨ã›ã„ãã‚“ï¼ˆç¬¬3å¼¾ï¼‰" class="mascot" />
      <h1>ç¬¬ï¼“å¼¾ï¼šæ€¥å¤‰å¯¾å¿œã®ãªãï¼ˆTMCï¼‰</h1>
    </header>

    <!-- âœ… å…¥åŠ›ç”»é¢ï¼ˆå®Œå…¨ã«å…ƒã®ã¾ã¾ï¼‰ -->
    <section id="screen-intro" class="card fade">
      <div class="hero">
        <img src="mame2.png" alt="ã¨ã›ã„ãã‚“ï¼ˆç¬¬3å¼¾ï¼‰" />
        <div class="speech">
          <strong>ã¼ãã¯ ã¨ã›ã„ãã‚“ã€‚</strong><br>
          <strong>TMC(ã¨ã†ã›ã„ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚«ãƒƒãƒ—ï¼‰ã®ãƒã‚¹ã‚³ãƒƒãƒˆã‚­ãƒ£ãƒ©ã ã‚ˆã€‚</strong><br>
          ã¾ãšã¯ã‚ãªãŸã®ã“ã¨<strong>æ•™ãˆã¦ï¼</strong>
        </div>
      </div>

      <div style="height:8px;"></div>

      <div class="form-vertical">
        <div>
          <label for="name">åå‰</label>
          <input id="name" type="text" placeholder="ä¾‹ï¼‰ãƒ•ãƒ«ãƒãƒ¼ãƒ " />
        </div>
        <div>
          <label for="group">æ‰€å±</label>
          <input id="group" type="text" placeholder="ä¾‹ï¼‰å¤–æ¥ï¼ã€‡ã€‡ç—…æ£Ÿï¼ãƒªãƒ ãªã©" />
        </div>
        <div>
          <label for="job">è·ç¨®</label>
          <input id="job" type="text" placeholder="ä¾‹ï¼‰çœ‹è­·å¸«ï¼åŒ»å¸«ï¼è–¬å‰¤å¸« ãªã©" />
        </div>
      </div>

      <div style="margin-top:16px;">
        <button class="btn" id="go-pre" onclick="goPre()">æ¬¡ã¸</button>
      </div>
    </section>

    <!-- âœ… ã‚¿ãƒ­ãƒƒãƒˆç”»é¢ï¼ˆå…ƒã®ä½ç½®ã«ãã®ã¾ã¾ï¼‰ -->
    <section id="screen-pre" class="card fade" style="display:none;">
      <div style="text-align:center; margin:10px 0;"><img src="./toseiuranai.png" alt="ã‚¿ãƒ­ãƒƒãƒˆå ã„ã‚’ã™ã‚‹ ã¨ã›ã„ãã‚“" class="tarot-hero" /></div>
      <div class="muted-box" style="margin:10px 0 14px;">
        <strong id="pre-title">ç¬¬ï¼“å¼¾ã€æ€¥å¤‰å¯¾å¿œã®ãªãã€ã¸ã‚ˆã†ã“ãï¼</strong><br>
        æº–å‚™ã¯ã„ã„ï¼Ÿ ã§ã¯å ã„ã‚¹ã‚¿ãƒ¼ãƒˆï¼
      </div>
      <button class="btn alt" id="begin-diag" onclick="beginFortune()">ã‚«ãƒ¼ãƒ‰ã‚’1æšå¼•ã</button>
    </section>

    <!-- âœ… å ã„çµæœ -->
    <section id="screen-diag-result" class="card fade" style="display:none;">
      <div id="type-title" class="question">ã¨ã›ã„ãã‚“ã®ã‚¿ãƒ­ãƒƒãƒˆå ã„</div>
      <div id="type-copy" class="lead"></div>

      <div class="fortune-wrap">
        <img src="mame2.png" alt="ã‚¿ãƒ­ãƒƒãƒˆã‚’æŒã¤ã¨ã›ã„ãã‚“" class="tarot-hero" />
        <div class="tarot-table" id="tarot-table"></div>
        <div id="fortune-lines" class="fortune-lines"></div>
      </div>

      <div id="advice-title" class="advice-title" style="display:none;">
        ğŸ”® ã‚¿ãƒ­ãƒƒãƒˆå ã„ã‹ã‚‰å‡ºãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹
      </div>
      <ul id="type-desc" style="text-align:left; line-height:1.8; margin-top:8px;"></ul>

      <div class="muted-box" style="margin-top:12px;">
        ã•ã‚ã€<strong>ç¬¬ï¼“å¼¾ï¼šæ€¥å¤‰å¯¾å¿œã®ãªã</strong>ã¸ï¼<br/>
        ã‚ãªãŸã®åŠ›ãªã‚‰è§£ã‘ã‚‹ã¯ãšï¼ï¼ã‚¯ã‚¤ã‚ºã«æŒ‘ã‚‚ã†ã€‚
      </div>
      <button class="btn" id="to-quiz" onclick="toQuiz()" style="margin-top:14px;">ç¬¬1å•ã¸é€²ã‚€</button>
    </section>

    <!-- âœ… ã‚¯ã‚¤ã‚º -->
    <section id="screen-quiz" class="card fade" style="display:none;">
      <div id="story" class="lead" style="margin-bottom:8px;"></div>
      <div style="text-align:center; margin:10px 0;">
        <img id="quiz-img" src="" alt="è¬ã®ç”»åƒ" style="max-width:100%; border-radius:14px; box-shadow:0 4px 12px rgba(0,0,0,0.1);" />
      </div>
      <div id="q-title" class="question"></div>
      <div id="choices" class="choices"></div>
      <div id="judge" class="result"></div>
      <div id="explain" class="explain" style="display:none;"></div>
      <div id="next-area" style="display:none; margin-top:12px;">
        <button id="next-btn" class="btn" onclick="goNext()">æ¬¡ã¸</button>
      </div>
    </section>

    <!-- âœ… ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼šç”»åƒã¯ mascot å°ã‚µã‚¤ã‚ºã®ã¿ -->
    <section id="screen-ending" class="card fade" style="display:none;">
      <div class="ending-wrap">
        <div class="ending-title">ğŸ‰ ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ï¼ï¼ˆç¬¬ï¼“å¼¾ï¼‰</div>

        <!-- âœ… ã“ã“ã ã‘ä¿®æ­£ï¼šãƒ‰ã‚¢ãƒƒãƒ—ç”»åƒã¯ä½¿ã‚ãšã€mascotã‚µã‚¤ã‚ºã«æˆ»ã™ -->
        <img src="mame2.png" alt="ã¨ã›ã„ãã‚“" class="mascot" />

        <div class="ending-lines">
          <div class="ending-badge">ã¨ã†ã›ã„ã®è¬ãƒ»åæ¢åµèªå®š</div>
          <div id="ending-text" style="margin-top:6px;"></div>
          <div style="margin-top:6px;">
            TMCã®ã“ã¨ã§èããŸã„ã“ã¨ãŒã‚ã‚Œã°ã€ã„ã¤ã§ã‚‚PHS6693ã«é€£çµ¡ã—ã¦ã­ã€‚
          </div>
        </div>
        <div class="ending-actions">
          <button class="btn ghost" id="finish-btn">ä»Šå›ã®èª¿æŸ»ã‚’çµ‚äº†ã™ã‚‹</button>
        </div>
        <div id="finish-message" style="display:none; margin-top:10px; font-weight:800; color:#374151;">
          ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
        </div>
      </div>
      <div class="confetti" id="confetti"></div>
      <div class="sparkles" id="sparkles"></div>
    </section>
  </div>

  <!-- æ­£è§£ã‚¹ã‚¿ãƒ³ãƒ— -->
  <div id="stamp" class="stamp" aria-hidden="true">
    <img src="nazotoki2.png" alt="æ­£è§£ã‚¹ã‚¿ãƒ³ãƒ—" />
  </div>

  <!-- ã‚µã‚¦ãƒ³ãƒ‰ -->
  <audio id="bgm" src="nazotoki2.mp3" preload="none" loop></audio>
  <audio id="seClick" src="pochi.mp3" preload="auto"></audio>
  <audio id="seCorrect" src="pinpon.mp3" preload="auto"></audio>
  <audio id="seClear" src="seikou.mp3" preload="auto"></audio>

<script>
 /* =========================
   ä»¥ä¸‹ JSï¼šå…ƒã®ã¾ã¾ï¼ˆå†…å®¹å¤‰æ›´ãªã—ï¼‰
   è¿½åŠ ã—ãŸã®ã¯ â€œscreen-pre ã‚’è¡¨ç¤ºâ€ ã®1è¡Œã®ã¿
   ========================= */
const GOOGLE_FORM_ACTION = "https://docs.google.com/forms/d/e//formResponse";
const ENTRY_NAME = "entry.6";
const ENTRY_DEPT = "entry.2";
const ENTRY_JOB  = "entry.6";

function sendToGoogleForm({ name, dept, job }) {
  try {
    const fd = new FormData();
    fd.append(ENTRY_NAME, name || "");
    fd.append(ENTRY_DEPT, dept || "");
    fd.append(ENTRY_JOB,  job  || "");
    fetch(GOOGLE_FORM_ACTION, { method: "POST", body: fd, mode: "no-cors" });
  } catch (e) {}
}

const nameEl  = document.getElementById('name');
const groupEl = document.getElementById('group');
const jobEl   = document.getElementById('job');

const screenIntro = document.getElementById('screen-intro');
const screenPre   = document.getElementById('screen-pre');
const screenDiagResult = document.getElementById('screen-diag-result');
const screenQuiz  = document.getElementById('screen-quiz');
const screenEnding= document.getElementById('screen-ending');

const preTitle = document.getElementById('pre-title');
const stampEl = document.getElementById('stamp');

const storyEl = document.getElementById('story');
const qTitleEl = document.getElementById('q-title');
const choicesEl = document.getElementById('choices');
const judgeEl = document.getElementById('judge');
const explainEl = document.getElementById('explain');
const nextArea = document.getElementById('next-area');
const nextBtn  = document.getElementById('next-btn');
const endingText = document.getElementById('ending-text');
const quizImgEl = document.getElementById('quiz-img');
const confettiEl = document.getElementById('confetti');
const sparklesEl = document.getElementById('sparkles');

const fortuneLinesEl = document.getElementById('fortune-lines');
const finishBtn = document.getElementById('finish-btn');
const finishMessage = document.getElementById('finish-message');
const tarotTable = document.getElementById('tarot-table');

// sound
const bgm = document.getElementById('bgm');
const seClick = document.getElementById('seClick');
const seCorrect = document.getElementById('seCorrect');
const seClear = document.getElementById('seClear');
let bgmStarted = false;

function playClick(){ try{ seClick.currentTime = 0; seClick.play(); }catch(e){} }
function playCorrect(){ try{ seCorrect.currentTime = 0; seCorrect.play(); }catch(e){} }
function ensureBGM(){
  if(!bgmStarted){
    bgmStarted = true;
    try{ bgm.volume = 0.8; bgm.play(); }catch(e){}
  }
}

document.addEventListener('click', function(e){
  const btn = e.target.closest('button');
  if (!btn) return;
  if (btn.classList.contains('choice-btn')) return;
  playClick();
}, true);

function hideAll(){ [screenIntro,screenPre,screenDiagResult,screenQuiz,screenEnding].forEach(e=>e.style.display='none'); }
function show(el){ hideAll(); el.style.display='block'; window.scrollTo({top:0,behavior:'smooth'}); }
show(screenIntro);

window.goPre = function(){
  if(!nameEl.value.trim()){ nameEl.focus(); nameEl.style.borderColor='#ff8dc7'; return; }
  nameEl.style.borderColor='#ffdff0';
  preTitle.textContent = "ç¬¬ï¼“å¼¾ã€æ€¥å¤‰å¯¾å¿œã®ãªãã€ã¸ã‚ˆã†ã“ãã€ " + nameEl.value + " ã•ã‚“ã€‚æœ€åˆã¯ã¼ãã®ã‚¿ãƒ­ãƒƒãƒˆå ã„ã§ä»Šæ—¥é‹å‹¢ã‚’å¼•ã„ã¦ã¿ã‚ˆã†ï¼";
  sendToGoogleForm({ name: nameEl.value, dept: groupEl.value, job: jobEl.value });
  show(screenPre);   // âœ… ã“ã“ã ã‘å¿…è¦ãªè¿½åŠ 
};

/* ã“ã“ã‹ã‚‰å…ˆã¯å ã„ãƒ»ã‚¯ã‚¤ã‚ºå‡¦ç†ã€å…ƒã®ã¾ã¾è²¼ã‚Šç›´ã—æ¸ˆã¿ */

const tarotDeck = [
  { key:"THE_SUN", title:"å¤ªé™½",
    upright:["ç¬‘é¡”ãŒã¿ã‚“ãªã‚’ç…§ã‚‰ã™æ—¥ï¼","å°ã•ãªã€ã§ããŸï¼ã€ã‚’å–œã¼ã†"],
    reversed:["å°‘ã—ãŠç–²ã‚Œãƒ¢ãƒ¼ãƒ‰â˜ï¸","ç„¡ç†ã›ãšå¥½ããªã“ã¨ã‚’ã—ã¦ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥"],
    tips:["ãƒãƒ¼ãƒ ã«æ˜ã‚‹ã•ã‚’åºƒã’ã‚ˆã†â˜€ï¸","è‡ªåˆ†ã‚’è¤’ã‚ã‚‹ã¨å¹¸é‹ã‚¢ãƒƒãƒ—ï¼"] },
  { key:"THE_STAR", title:"æ˜Ÿ",
    upright:["ç†æƒ³ãŒã‚­ãƒ©ã‚­ãƒ©è¼ãæ—¥ğŸŒŸ","å¤¢ã‚’å£ã«å‡ºã™ã¨å¶ã„ã‚„ã™ã„ã‹ã‚‚ï¼"],
    reversed:["ã¡ã‚‡ã£ã¨ç¾å®Ÿé€ƒé¿ãã¿ï¼Ÿ","è¶³å…ƒã®ä¸€æ­©ã‚’å¤§åˆ‡ã«ã—ã‚ˆã†"],
    tips:["é¡˜ã„ã”ã¨ã¯ã‚¹ãƒãƒ›ã®ãƒ¡ãƒ¢ã«æ›¸ã„ã¦ã¿ã‚ˆã†","æ˜Ÿç©ºã‚’è¦‹ä¸Šã’ã¦æ·±å‘¼å¸ã—ã¦ã­"] },
  { key:"THE_HERMIT", title:"éš è€…",
    upright:["ã˜ã£ãã‚Šè€ƒãˆã‚‹ã»ã©é‹ãŒå‘³æ–¹ã«âœ¨","é™ã‹ãªæ™‚é–“ã«ã²ã‚‰ã‚ããŒç”Ÿã¾ã‚Œã‚‹ã‹ã‚‚"],
    reversed:["ã²ã¨ã‚Šã§æŠ±ãˆã“ã¿ã™ãæ³¨æ„ğŸ’¦","èª°ã‹ã«è©±ã™ã¨å¿ƒãŒè»½ããªã‚‹ã‚ˆ"],
    tips:["å¤œã®ãŠèŒ¶ã‚¿ã‚¤ãƒ ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹â˜•","ç„¦ã‚‰ãšãƒã‚¤ãƒšãƒ¼ã‚¹ã§OK"] },
  { key:"JUSTICE", title:"æ­£ç¾©",
    upright:["åˆ¤æ–­åŠ›ãŒã•ãˆã‚‹æ—¥âš–ï¸","ã¾ã£ã™ããªæ°—æŒã¡ãŒä¿¡é ¼ã‚’å‘¼ã¶ï¼"],
    reversed:["å°‘ã—é ‘å›ºã«ãªã£ã¦ã‚‹ã‹ã‚‚ï¼Ÿ","æŸ”ã‚‰ã‹ã„è¨€è‘‰ã§ä¼ãˆã¦ã¿ã‚ˆã†ğŸ˜Š"],
    tips:["å›°ã£ãŸã‚‰â€œã©ã£ã¡ãŒç¬‘é¡”ã«ãªã‚Œã‚‹ã‹â€ã§é¸ã¼ã†","æ­£ç›´ã•ãŒå¹¸é‹ã‚’å‘¼ã¶æ—¥ã ã‚ˆ"] },
  { key:"THE_MAGICIAN", title:"é­”è¡“å¸«",
    upright:["æ–°ã—ã„ã“ã¨ã‚’å§‹ã‚ã‚‹ã®ã«æœ€é«˜ã®æ—¥ğŸ©","ã‚ãªãŸã®ã‚¢ã‚¤ãƒ‡ã‚¢ãŒè¼ãï¼"],
    reversed:["ç„¦ã‚Šã¯ç¦ç‰©ğŸ’¦","åŠ©ã‘ã‚’æ±‚ã‚ã‚‹ã®ã‚‚ç«‹æ´¾ãªé­”æ³•ã ã‚ˆ"],
    tips:["ã²ã‚‰ã‚ãã‚’ãƒ¡ãƒ¢ã—ã¦ãŠã“ã†âœ¨","ã€ã‚„ã£ã¦ã¿ã‚ˆã†ï¼ã€ã®ä¸€æ­©ãŒå¹¸é‹ã®ã‚«ã‚®"] },
  { key:"STRENGTH", title:"åŠ›",
    upright:["å„ªã—ã•ã¨æ ¹æ°—ãŒä»Šæ—¥ã®ãƒ‘ãƒ¯ãƒ¼ğŸ’ª","ã‚†ã£ãã‚Šæ·±å‘¼å¸ã§è½ã¡ç€ã„ã¦â—"],
    reversed:["ã¡ã‚‡ã£ã¨ã‚¤ãƒ©ã‚¤ãƒ©æ³¨æ„âš¡","æ€’ã‚‹ã‚ˆã‚Šç¬‘ã£ã¦ãƒªã‚»ãƒƒãƒˆã—ã‚ˆã†ï¼"],
    tips:["ã»ã‚è¨€è‘‰ã‚’ä¼ãˆã‚‹ã¨é‹æ°—UP","è‡ªåˆ†ã«ã‚‚â€œã‚ˆãé ‘å¼µã£ã¦ã‚‹ã­â€ã£ã¦å£°ã‹ã‘ã‚’"] },
  { key:"TEMPERANCE", title:"ç¯€åˆ¶",
    upright:["ãƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šãŒå…‰ã‚‹æ—¥ğŸŒˆ","ä¼‘æ†©ã‚‚ä»•äº‹ã‚‚ã„ã„ãƒªã‚ºãƒ ã§â—"],
    reversed:["å°‘ã—åã£ã¦ã‚‹ã‹ã‚‚ï¼Ÿ","ãŠè“å­ã¨ã‚³ãƒ¼ãƒ’ãƒ¼ã§ã»ã£ã¨ä¸€æ¯ğŸª"],
    tips:["â€œã¾ã‚ã„ã£ã‹â€ã®æ°—æŒã¡ãŒãƒ„ã‚­ã‚’å‘¼ã¶","ç„¡ç†ã›ãšãƒã‚¤ãƒšãƒ¼ã‚¹ã§OKï¼"] },
  { key:"THE_WORLD", title:"ä¸–ç•Œ",
    upright:["ã‚„ã‚Šãã‚‹å–œã³ã‚’æ„Ÿã˜ã‚‹æ—¥ğŸŒ","å‘¨ã‚Šã¨ç¬‘é¡”ã‚’åˆ†ã‹ã¡åˆãŠã†ï¼"],
    reversed:["ã‚‚ã†å°‘ã—ã§å®Œæˆâœ¨","ã‚ã›ã‚‰ãšä¸å¯§ã«ä»•ä¸Šã’ã‚ˆã†"],
    tips:["æœ€å¾Œã¾ã§ç¬‘é¡”ã§GOï¼","å†™çœŸã‚’æ’®ã£ã¦è¨˜å¿µã«æ®‹ãã†ğŸ“¸"] }
];

function drawTarot(){
  const idx = Math.floor(Math.random()*tarotDeck.length);
  const up  = Math.random() < 0.7;
  const card = tarotDeck[idx];
  return { card, upright: up };
}

function renderFortune(lines){
  fortuneLinesEl.innerHTML = "";
  let i = 0;
  (function next(){
    if(i >= lines.length) return;
    const div = document.createElement('div');
    div.className = 'fortune-line';
    div.textContent = lines[i++];
    fortuneLinesEl.appendChild(div);
    setTimeout(next, 900);
  })();
}

function showAdviceTitle(){
  const at = document.getElementById('advice-title');
  if(at){ at.style.display = 'block'; }
}

window.beginFortune = function(){
  ensureBGM();
  const result = drawTarot();
  tarotTable.innerHTML = "";
  const cardEl = document.createElement('div');
  cardEl.className = 'tarot-card' + (result.upright ? '' : ' reversed');
  cardEl.innerHTML = '<div style="font-size:32px;">ğŸ”®</div><div class="cap">'+ result.card.title + (result.upright? "ï¼ˆæ­£ä½ç½®ï¼‰":"ï¼ˆé€†ä½ç½®ï¼‰") +'</div>';
  tarotTable.appendChild(cardEl);

  const lines = [
    "ã¨ã›ã„ãã‚“ãŒã‚¿ãƒ­ãƒƒãƒˆã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«â€¦â€¦",
    "å‡ºãŸã®ã¯â€¦â€¦â€¦â€¦ ã€Œ" + result.card.title + "ã€ï¼",
    result.upright ? "ä»Šæ—¥ã¯æ­£ä½ç½®ã€‚è‰¯ã„æµã‚Œã‚’æ´»ã‹ãã†ï¼" : "ä»Šæ—¥ã¯é€†ä½ç½®ã€‚è½ã¡ç€ã„ã¦æ•´ãˆã‚‹ã¨å¥½è»¢ã™ã‚‹ã‚ˆã€‚",
    ...(result.upright ? result.card.upright : result.card.reversed)
  ];
  document.getElementById('type-copy').textContent = "ä»Šæ—¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼š " + (result.upright ? "å‰å‘ããªæµã‚Œ" : "è¶³å…ƒã®æ•´ãˆç›´ã—");

  const ul = document.getElementById('type-desc');
  ul.innerHTML = "";
  result.card.tips.forEach(t=>{
    const li=document.createElement('li'); li.textContent = "ğŸ”¸ " + t; ul.appendChild(li);
  });

  showAdviceTitle();
  show(screenDiagResult);
  setTimeout(()=>{ renderFortune(lines); }, 80);
};

/* ã‚¯ã‚¤ã‚ºï¼šå…ƒã®ã¾ã¾ */
const quiz = [
  {
    story: "ğŸ“çŠ¶æ³ï¼šã¨ã›ã„ãã‚“ãŒç—…é™¢ã®ä¸­ã‚’æ­©ã„ã¦ã„ã‚‹ã¨ã€ç›®ã®å‰ã§æ‚£è€…ã•ã‚“ã®å…·åˆãŒæ‚ªããªã‚Šã¾ã—ãŸã€‚",
    title: "è¬1ï¼šã•ã¦ã€ã¨ã›ã„ãã‚“ã¯ã¾ãšæœ€åˆã«ä½•ã‚’è¦³å¯Ÿã—ãŸã‚‰ã„ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ",
    choices: [
      {label:"1ï¼‰è¡€åœ§", correct:false},
      {label:"2ï¼‰ä½“æ¸©", correct:false},
      {label:"3ï¼‰å‘¼å¸", correct:true}
    ],
    explain: [
      "è„³ã‚„å¿ƒè‡“ã«ç•°å¸¸ãŒã¿ã‚‰ã‚Œã‚‹ã¨ã€æ­£å¸¸ãªå‘¼å¸ã‚’ä¿ã¦ãªããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚å‘½ã«é–¢ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ã¾ãšâ€œå‘¼å¸â€ã‚’è¦³å¯Ÿã—ã¾ã™ã€‚",
      "æ­£å¸¸ãªå‘¼å¸ã¯æˆäººã§ 16ã€œ20 å›/åˆ†ã®ç›®å®‰ã€‚10ç§’æ•°ãˆã¦ã‚‚å‘¼å¸ãŒè¦‹ã‚‰ã‚Œãªã„å ´åˆã¯ã€ã™ãã«å¿œæ´ã‚’å‘¼ã³ã¾ã—ã‚‡ã†ã€‚",
      "ï¼ˆã“ã®å¾Œã€æ„è­˜ãŒãªããªã‚Šè„ˆã‚‚è§¦ã‚Œãªã„ â†’ å¤§å£°ã§å¿œæ´ãƒ»ãƒ‰ã‚¯ã‚¿ãƒ¼ã‚³ãƒ¼ãƒ«ãƒ»AEDãƒ»æ•‘æ€¥ã‚«ãƒ¼ãƒˆã‚’è¦è«‹ï¼‰"
    ]
  },
  {
    story: "ğŸ†˜ ã¨ã›ã„ãã‚“ã¯å¿œæ´ã‚’å‘¼ã¶ã“ã¨ã«ã—ã¾ã—ãŸã€‚",
    title: "è¬2ï¼šè¦è«‹ã™ã‚‹â€œãƒ‰ã‚¯ã‚¿ãƒ¼ã‚³ãƒ¼ãƒ«â€ã®ç•ªå·ã¯ä½•ç•ªã§ã—ã‚‡ã†ï¼Ÿ",
    choices: [
      {label:"1ï¼‰5151ï¼šæ‚£è€…æ”¯æ´ã‚»ãƒ³ã‚¿ãƒ¼èª¬æ˜å®¤", correct:false},
      {label:"2ï¼‰6693ï¼šèªå®šçœ‹è­·å¸«ã®PHS", correct:false},
      {label:"3ï¼‰7171ï¼šæ•‘å‘½æ•‘æ€¥ã‚»ãƒ³ã‚¿ãƒ¼å—ä»˜", correct:true},
      {label:"4ï¼‰7711ï¼š7Eç—…æ£Ÿ", correct:false}
    ],
    explain: [
      "æ­£è§£ã¯ 7171ï¼ˆæ•‘å‘½æ•‘æ€¥ã‚»ãƒ³ã‚¿ãƒ¼å—ä»˜ï¼‰ã€‚è‡³æ€¥é€£çµ¡ãƒ»æ”¯æ´è¦è«‹ã®ç•ªå·ã‚’è¦šãˆã¦ãŠã“ã†ï¼",
      "ã¡ãªã¿ã«ã€é™¢å†…ã®AEDã¯ 25 å°ã‚ã‚Šã¾ã™ã€‚AEDåˆ°ç€ã¾ã§ã¯èƒ¸éª¨åœ§è¿«ï¼ˆå¿ƒè‡“ãƒãƒƒã‚µãƒ¼ã‚¸ï¼‰ã‚’ç¶™ç¶šã—ã¾ã™ã€‚"
    ]
  },
  {
    story: "ğŸš‘ AEDãŒåˆ°ç€ã™ã‚‹ã¾ã§ã€ã¨ã›ã„ãã‚“ã¯èƒ¸éª¨åœ§è¿«ã‚’è¡Œã„ã¾ã™ã€‚",
    title: "è¬3ï¼šèƒ¸éª¨åœ§è¿«ï¼ˆå¿ƒè‡“ãƒãƒƒã‚µãƒ¼ã‚¸ï¼‰ã¯1åˆ†é–“ã«ã©ã®ãã‚‰ã„ã®å›æ•°ã§è¡Œã†ã®ãŒæ­£ã—ã„ï¼Ÿ",
    choices: [
      {label:"1ï¼‰90ã€œ100 å›/åˆ†", correct:false},
      {label:"2ï¼‰100ã€œ120 å›/åˆ†", correct:true},
      {label:"3ï¼‰120ã€œ140 å›/åˆ†", correct:false}
    ],
    explain: [
      "èƒ¸éª¨åœ§è¿«ã¯ä¸€å®šã®ãƒªã‚ºãƒ ã§çµ¶ãˆé–“ãªãã€‚èƒ¸éƒ¨ã®çœŸã‚“ä¸­ã«ä¸¡æ‰‹ã‚’ç½®ãã€5ã€œ6cmã®æ·±ã•ã§åœ§è¿«ã—ã€èƒ¸ãŒã—ã£ã‹ã‚Šæˆ»ã‚‹ã®ã‚’ç¢ºèªã—ã¾ã™ã€‚",
      "ç›®å®‰ã«ãªã‚‹æ›²ï¼šã€ã‚¢ãƒ³ãƒ‘ãƒ³ãƒãƒ³ãƒãƒ¼ãƒã€ã€ãƒ‰ãƒ©ãˆã‚‚ã‚“ã®ã†ãŸã€ã€ã†ã•ãã¨ã‹ã‚ã€ãªã©ã¯ 100 æ‹/åˆ† ç¨‹åº¦ã§å‚è€ƒã«ãªã‚Šã¾ã™ã€‚",
      "å›°ã£ãŸæ™‚ã¯æ€¥æ€§ãƒ»é‡ç—‡æ‚£è€…çœ‹è­·å°‚é–€çœ‹è­·å¸«ã‚„æ•‘æ€¥çœ‹è­·èªå®šçœ‹è­·å¸«ã€é›†ä¸­ã‚±ã‚¢èªå®šçœ‹è­·å¸«ã«ç›¸è«‡ã—ã‚ˆã†ã€‚é™¢å†…ç ”ä¿®ã®ICLSã‚‚å®šæœŸçš„ã«å—è¬›ãŒå¤§åˆ‡ã ã­ã€‚"
    ]
  }
];
let quizIndex = 0;

window.toQuiz = function(){
  quizIndex = 0;
  renderQuiz();
  show(screenQuiz);
};

function renderQuiz(){
  const q = quiz[quizIndex];
  storyEl.innerHTML = q.story;
  quizImgEl.src = "";
  qTitleEl.textContent = q.title;
  choicesEl.innerHTML = "";
  judgeEl.textContent = "";
  explainEl.style.display = "none";
  explainEl.innerHTML = "";
  nextArea.style.display = "none";

  q.choices.forEach(c=>{
    const b = document.createElement('button');
    b.className = 'choice-btn';
    b.textContent = c.label;
    b.onclick = ()=>{ judge(c.correct); };
    choicesEl.appendChild(b);
  });
}

function showStamp(){
  stampEl.style.display = 'flex';
  setTimeout(()=>{ stampEl.style.display = 'none'; }, 700);
}

function judge(isCorrect){
  if(isCorrect){
    judgeEl.textContent = "æ­£è§£ï¼";
    judgeEl.className = "result ok";
    try{ seCorrect.currentTime = 0; seCorrect.play(); }catch(e){}
    showStamp();

    const q = quiz[quizIndex];
    explainEl.innerHTML = "<strong>è§£èª¬</strong><ul style='margin:6px 0 0; padding-left:18px;'>" +
      q.explain.map(t=>"<li>"+ t +"</li>").join("") + "</ul>";
    explainEl.style.display = "block";
    nextArea.style.display = "block";
  }else{
    judgeEl.textContent = "æ®‹å¿µï¼ã‚‚ã†ä¸€åº¦é¸ã‚“ã§ã¿ã‚ˆã†ã€‚";
    judgeEl.className = "result ng";
  }
}

window.goNext = function(){
  quizIndex++;
  if(quizIndex < quiz.length){
    renderQuiz();
    window.scrollTo({top:0, behavior:'smooth'});
  }else{
    const nm = (nameEl.value || "åæ¢åµ").trim();
    endingText.innerHTML = "<strong>"+ nm +"ã•ã‚“ã€ã‚ã‚ŠãŒã¨ã†ï¼</strong><br>æ€¥å¤‰æ™‚ã¯â€œå‘¼å¸ã®è¦³å¯Ÿâ†’å¿œæ´â†’ãƒ‰ã‚¯ã‚¿ãƒ¼ã‚³ãƒ¼ãƒ«ï¼ˆ7171ï¼‰â†’èƒ¸éª¨åœ§è¿«100ã€œ120å›/åˆ†â€ã‚’æ„è­˜ã—ã¦ã„ã“ã†ã€‚";
    show(screenEnding);
    launchConfetti();
    launchSparkles();
    try{ seClear.currentTime = 0; seClear.play(); }catch(e){}
    window.scrollTo({top:0, behavior:'smooth'});
  }
};

function launchConfetti(){
  confettiEl.innerHTML = "";
  const colors = ["#ff7ac6","#ffd166","#7bdff2","#c3f0ca","#b5b0ff"];
  for(let i=0;i<40;i++){
    const s = document.createElement('span');
    const size = 8 + Math.random()*10;
    s.style.width = size + "px";
    s.style.height = (size*1.6) + "px";
    s.style.left = (Math.random()*100) + "%";
    s.style.background = colors[Math.floor(Math.random()*colors.length)];
    s.style.animationDelay = (Math.random()*0.8) + "s";
    confettiEl.appendChild(s);
  }
}

function launchSparkles(){
  sparklesEl.innerHTML = "";
  for(let i=0;i<18;i++){
    const sp = document.createElement('div');
    sp.className = 'spark';
    sp.style.left = (Math.random()*100) + "%";
    sp.style.top  = (Math.random()*100) + "%";
    sp.style.animationDelay = (Math.random()*1.2) + "s";
    sparklesEl.appendChild(sp);
  }
}

finishBtn.addEventListener('click', function(){
  try{ bgm.pause(); }catch(e){}
  finishMessage.style.display = 'block';
  finishBtn.disabled = true;
  finishBtn.textContent = 'çµ‚äº†ã—ã¾ã—ãŸ';
});
</script>

</body>
</html>
